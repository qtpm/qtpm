cmake_minimum_required(VERSION 3.1.0)

# project global setting

project([[.TargetSmall]])

# compiler setting

set(CMAKE_CXX_STANDARD 11)

# enable Qt

set(CMAKE_AUTOMOC ON)
set(CMAKE_AUTOUIC ON)
set(CMAKE_INCLUDE_CURRENT_DIR ON)
if(DEFINED ENV{QTDIR})
    set(CMAKE_PREFIX_PATH "$ENV{QTDIR}")
endif()
if(DEFINED ENV{QTPM_INCLUDE_PATH})
    include_directories("$ENV{QTPM_INCLUDE_PATH}")
endif()
if(DEFINED ENV{QTPM_LIBRARY_PATH})
    link_directories("$ENV{QTPM_LIBRARY_PATH}")
endif()

[[range $module := .QtModules]]find_package(Qt5[[$module]] REQUIRED)
[[end]]
# include extra settings

include("CMakeExtra.txt" OPTIONAL)

# build setting

include_directories(src)
[[.Sources.DefineList]][[if .Resources.HasItem]][[.Resources.DefineList]]qt5_add_resources(QRC ${[[.Resources.Name]]})
[[end]][[if gt (len .Requires) 0]]
link_libraries([[range .Requires]] [[.]][[end]])[[end]]
add_executable([[.TargetSmall]] src/main.cpp[[if .Sources.HasItem]] ${[[.Sources.Name]]}[[end]][[if .Resources.HasItem]] ${QRC}[[end]])
qt5_use_modules([[.TargetSmall]][[range $module := .QtModules]] [[$module]][[end]])

[[if .Tests.HasItem]]
# enable tests

enable_testing()
find_package(Qt5Test REQUIRED)
[[.ExtraTestSources.DefineList]]
[[.Tests.StartLoop]]
  add_executable(${file} "test/${file}.cpp"[[if .ExtraTestSources.HasItem]] ${[[.ExtraTestSources.Name]]}[[end]][[if .Resources.hasItem]] ${QRC}[[end]])
  add_test(NAME ${file} COMMAND ${file} WORKING_DIRECTORY build)
  qt5_use_modules(${file} Test[[range $module := .QtModules]] [[$module]][[end]])
[[.Tests.EndLoop]]
[[end]]